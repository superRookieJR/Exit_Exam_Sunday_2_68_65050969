generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model canteens {
  id          Int          @id @default(autoincrement())
  code        String       @unique @db.VarChar(50)
  name        String       @db.VarChar(255)
  position_id Int
  departments departments  @relation(fields: [position_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  complaints  complaints[]
  stalls      stalls[]
}

model complaint_types {
  id         Int          @id @default(autoincrement())
  title      String       @db.VarChar(255)
  complaints complaints[]
}

model complaints {
  id              String             @id @db.Uuid
  code            String             @unique @db.VarChar(50)
  user_id         String?            @db.Uuid
  canteen_id      Int
  stall_id        Int?
  type_id         Int
  details         String?
  status          complaints_status? @default(IN_PROGRESS)
  created_at      DateTime?          @default(now()) @db.Timestamp(6)
  updated_at      DateTime?          @default(now()) @db.Timestamp(6)
  canteens        canteens           @relation(fields: [canteen_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stalls          stalls?            @relation(fields: [stall_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  complaint_types complaint_types    @relation(fields: [type_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users           users?             @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  responses       responses[]
}

model departments {
  id       Int        @id @default(autoincrement())
  name     String     @db.VarChar(255)
  canteens canteens[]
}

model responses {
  id           String      @id @db.Uuid
  user_id      String?     @db.Uuid
  complaint_id String?     @db.Uuid
  message      String
  created_at   DateTime?   @default(now()) @db.Timestamp(6)
  complaints   complaints? @relation(fields: [complaint_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        users?      @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model roles {
  id    Int     @id @default(autoincrement())
  name  String  @db.VarChar(100)
  users users[]
}

model stalls {
  id         Int          @id @default(autoincrement())
  name       String       @db.VarChar(255)
  canteen_id Int
  complaints complaints[]
  canteens   canteens     @relation(fields: [canteen_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id         String       @id @db.Uuid
  email      String       @unique @db.VarChar(255)
  first_name String       @db.VarChar(100)
  last_name  String       @db.VarChar(100)
  role_id    Int
  complaints complaints[]
  responses  responses[]
  roles      roles        @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

enum complaints_status {
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REJECTED
}
